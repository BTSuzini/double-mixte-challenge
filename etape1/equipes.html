<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ã‰quipes â€” Ã‰tape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="brand-logo">
        <img src="../assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <h1 class="brand-title">
        Ã‰tape 1 - 27 fÃ©vrier 2026
        <span class="brand-subtitle">BT250</span>
      </h1>

      <div class="brand-logo">
        <img src="../assets/img/logo-challenge.png" alt="Logo Challenge">
      </div>
    </div>

    <nav class="nav">
      <a href="../index.html">Accueil</a>
      <a href="index.html">Ã‰tape 1</a>
      <a href="inscriptions.html">Inscriptions</a>
      <a href="equipes.html">Ã‰quipes</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>ðŸ‘¥ Ã‰quipes inscrites</h2>
    <p class="muted">Liste affichÃ©e dans lâ€™ordre dâ€™inscription.</p>

    <div id="status" class="muted">Chargementâ€¦</div>
    <div id="teams" class="teams"></div>
  </section>

</main>

<style>
  .teams{ display:grid; gap:10px; margin-top:12px; }
  .team-row{
    border:1px solid #eee;
    border-radius:14px;
    padding:12px 14px;
    background:#fff;
    display:flex;
    gap:10px;
    align-items:baseline;
    justify-content:space-between;
  }
  .team-left{ display:flex; gap:10px; align-items:baseline; flex-wrap:wrap; }
  .team-name{ font-weight:800; }
  .team-players{ color:#444; }
  .team-index{ color:#888; font-size:13px; min-width:2.5ch; text-align:right; }
</style>

<script type="module">
  import { db } from "../shared/firebase.js";
  import { collection, getDocs, query, orderBy }
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const statusEl = document.getElementById("status");
  const teamsEl = document.getElementById("teams");

  function esc(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  async function loadTeams(){
    statusEl.textContent = "Chargementâ€¦";

    let snap;
    try{
      snap = await getDocs(query(collection(db, "equipes_etape1_public"), orderBy("createdAt", "asc")));
    }catch(e){
      snap = await getDocs(query(collection(db, "equipes_etape1_public")));
    }

    const rows = [];
    snap.forEach(doc => {
      const d = doc.data() || {};
      rows.push({
        teamName: d.teamName || "",
        p1FirstName: d.p1FirstName || "",
        p2FirstName: d.p2FirstName || "",
        createdAt: d.createdAt?.toMillis ? d.createdAt.toMillis() : 0
      });
    });

    rows.sort((a,b) => (a.createdAt||0) - (b.createdAt||0));

    if(rows.length === 0){
      statusEl.textContent = "Aucune Ã©quipe inscrite pour le moment.";
      teamsEl.innerHTML = "";
      return;
    }

    statusEl.textContent = `${rows.length} Ã©quipe(s) inscrite(s).`;

    teamsEl.innerHTML = rows.map((r, idx) => `
      <div class="team-row">
        <div class="team-left">
          <span class="team-name">${esc(r.teamName)}</span>
          <span class="team-players">â€” ${esc(r.p1FirstName)} / ${esc(r.p2FirstName)}</span>
        </div>
        <div class="team-index">#${idx+1}</div>
      </div>
    `).join("");
  }

  loadTeams();
</script>

</body>
</html>
