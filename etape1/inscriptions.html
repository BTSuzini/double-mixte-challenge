<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscriptions ‚Äî √âtape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="brand-logo">
        <img src="../assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <h1 class="brand-title">
        √âtape 1 - 27 f√©vrier 2026
        <span class="brand-subtitle">BT250</span>
      </h1>

      <div class="brand-logo">
        <img src="../assets/img/logo-challenge.png" alt="Logo Challenge">
      </div>
    </div>

    <nav class="nav">
      <a href="../index.html">Accueil</a>
      <a href="index.html">√âtape 1</a>
      <a href="equipes.html">√âquipes</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>üìã Formulaire d‚Äôinscription</h2>
    <p class="muted">Tous les champs sont obligatoires.</p>

    <form id="signupForm" class="form" autocomplete="on">

      <label class="field">
        <span>Nom de l‚Äô√©quipe *</span>
        <input id="teamName" required>
      </label>

      <hr class="sep">

      <h3>Joueur 1</h3>
      <label class="field"><span>Nom *</span><input id="p1LastName" required></label>
      <label class="field"><span>Pr√©nom *</span><input id="p1FirstName" required></label>
      <label class="field"><span>N¬∞ Licence *</span><input id="p1Licence" required></label>
      <label class="field"><span>T√©l√©phone *</span><input id="p1Phone" required inputmode="tel"></label>

      <hr class="sep">

      <h3>Joueur 2</h3>
      <label class="field"><span>Nom *</span><input id="p2LastName" required></label>
      <label class="field"><span>Pr√©nom *</span><input id="p2FirstName" required></label>
      <label class="field"><span>N¬∞ Licence *</span><input id="p2Licence" required></label>
      <label class="field"><span>T√©l√©phone *</span><input id="p2Phone" required inputmode="tel"></label>

      <button class="btn" type="submit">‚úÖ Valider</button>
      <p id="status" class="muted" aria-live="polite"></p>
    </form>
  </section>

</main>

<script type="module">
  import { db } from "../shared/firebase.js";
  import { collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const $ = (id)=>document.getElementById(id);
  const cleanText = (v)=> (v ?? "").toString().trim();
  const cleanPhone = (v)=> cleanText(v).replace(/[^0-9+]/g, "");

  $("signupForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    $("status").textContent = "‚è≥ Envoi en cours...";

    const teamName = cleanText($("teamName").value);

    const p1LastName = cleanText($("p1LastName").value);
    const p1FirstName = cleanText($("p1FirstName").value);
    const p1Licence = cleanText($("p1Licence").value);
    const p1Phone = cleanPhone($("p1Phone").value);

    const p2LastName = cleanText($("p2LastName").value);
    const p2FirstName = cleanText($("p2FirstName").value);
    const p2Licence = cleanText($("p2Licence").value);
    const p2Phone = cleanPhone($("p2Phone").value);

    const required = [teamName,p1LastName,p1FirstName,p1Licence,p1Phone,p2LastName,p2FirstName,p2Licence,p2Phone];
    if (required.some(v => !v)) {
      $("status").textContent = "‚ùå Merci de compl√©ter tous les champs obligatoires.";
      return;
    }

    try{
      // 1) PRIV√â : tout
      await addDoc(collection(db,"inscriptions_etape1_private"), {
        teamName,
        p1LastName, p1FirstName, p1Licence, p1Phone,
        p2LastName, p2FirstName, p2Licence, p2Phone,
        createdAt: serverTimestamp()
      });

      // 2) PUBLIC : uniquement nom √©quipe + pr√©noms
      await addDoc(collection(db,"equipes_etape1_public"), {
        teamName,
        p1FirstName,
        p2FirstName,
        createdAt: serverTimestamp()
      });

      $("status").textContent = "‚úÖ Inscription envoy√©e !";
      e.target.reset();
    }catch(err){
      console.error(err);
      $("status").textContent = "‚ùå Erreur, r√©essaie.";
    }
  });
</script>

</body>
</html>
