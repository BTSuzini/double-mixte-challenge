<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscriptions â€” Ã‰tape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css?v=3" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="brand-logo">
        <img src="../assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <h1 class="brand-title">Ã‰tape 1 â€” BT250</h1>

      <div class="brand-logo">
        <img src="../assets/img/logo-challenge.png" alt="Logo Challenge">
      </div>
    </div>

    <nav class="nav">
      <a href="index.html">Accueil</a>
      <a href="programmation.html">Programmation</a>
      <a href="inscriptions.html">Inscriptions</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>ğŸ“‹ Formulaire dâ€™inscription</h2>
    <p class="muted">Tous les champs sont obligatoires.</p>

    <form id="signupForm" class="form" autocomplete="on">
      <label class="field">
        <span>Nom de lâ€™Ã©quipe *</span>
        <input id="teamName" required />
      </label>

      <hr class="sep">

      <h3>Joueur 1</h3>
      <label class="field"><span>Nom *</span><input id="p1LastName" required /></label>
      <label class="field"><span>PrÃ©nom *</span><input id="p1FirstName" required /></label>
      <label class="field"><span>NÂ° Licence *</span><input id="p1Licence" required /></label>
      <label class="field"><span>TÃ©lÃ©phone *</span><input id="p1Phone" required inputmode="tel" /></label>

      <hr class="sep">

      <h3>Joueur 2</h3>
      <label class="field"><span>Nom *</span><input id="p2LastName" required /></label>
      <label class="field"><span>PrÃ©nom *</span><input id="p2FirstName" required /></label>
      <label class="field"><span>NÂ° Licence *</span><input id="p2Licence" required /></label>
      <label class="field"><span>TÃ©lÃ©phone *</span><input id="p2Phone" required inputmode="tel" /></label>

      <button class="btn" type="submit">âœ… Valider</button>
      <p id="status" class="muted" aria-live="polite"></p>
    </form>
  </section>

</main>

<script type="module">
  import { db } from "../shared/firebase.js";
  import { collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const $ = (id)=>document.getElementById(id);
  const cleanText = (v)=> (v ?? "").toString().trim();
  const cleanPhone = (v)=> cleanText(v).replace(/[^0-9+]/g, "");

  $("signupForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    $("status").textContent = "â³ Envoi en cours...";

    const payload = {
      teamName: cleanText($("teamName").value),

      p1LastName: cleanText($("p1LastName").value),
      p1FirstName: cleanText($("p1FirstName").value),
      p1Licence: cleanText($("p1Licence").value),
      p1Phone: cleanPhone($("p1Phone").value),

      p2LastName: cleanText($("p2LastName").value),
      p2FirstName: cleanText($("p2FirstName").value),
      p2Licence: cleanText($("p2Licence").value),
      p2Phone: cleanPhone($("p2Phone").value),

      createdAt: serverTimestamp()
    };

    const required = [
      "teamName","p1LastName","p1FirstName","p1Licence","p1Phone",
      "p2LastName","p2FirstName","p2Licence","p2Phone"
    ];
    if (required.some(k => !payload[k])) {
      $("status").textContent = "âŒ Merci de complÃ©ter tous les champs obligatoires.";
      return;
    }

    try{
      await addDoc(collection(db,"inscriptions_etape1"), payload);
      $("status").textContent="âœ… Inscription envoyÃ©e !";
      e.target.reset();
    }catch(err){
      console.error(err);
      $("status").textContent="âŒ Erreur, rÃ©essaie.";
    }
  });
</script>

</body>
</html>
