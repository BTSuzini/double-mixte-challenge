<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscriptions ‚Äî √âtape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="brand-logo">
        <img src="../assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <h1 class="brand-title">√âtape 1 ‚Äî 27 f√©vrier 2026<br><span style="opacity:.95;font-weight:800;">BT250</span></h1>

      <div class="brand-logo">
        <img src="../assets/img/logo-challenge.png" alt="Logo Challenge">
      </div>
    </div>

    <nav class="nav">
      <a href="../index.html">Accueil</a>
      <a href="programmation.html">Programmation</a>
      <a href="equipes.html">√âquipes</a>
      <a href="inscriptions.html" aria-current="page">Inscriptions</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>Formulaire d‚Äôinscription</h2>
    <p class="muted">Tous les champs marqu√©s d‚Äôun * sont obligatoires.</p>

    <form id="signupForm" class="form" autocomplete="on">

      <div class="field">
        <label for="teamName">Nom de l‚Äô√©quipe *</label>
        <input id="teamName" name="teamName" type="text" required maxlength="40" placeholder="Ex : Les Lobstars">
      </div>

      <hr class="sep" />

      <h3 style="margin:0;">Joueuse üë©</h3>

      <div class="field">
        <label for="p1LastName">Nom *</label>
        <input id="p1LastName" name="p1LastName" type="text" required placeholder="Nom">
      </div>

      <div class="field">
        <label for="p1FirstName">Pr√©nom *</label>
        <input id="p1FirstName" name="p1FirstName" type="text" required placeholder="Pr√©nom">
      </div>

      <div class="field">
        <label for="p1Licence">N¬∞ Licence *</label>
        <input id="p1Licence" name="p1Licence" type="text" required placeholder="Ex : 0123456A">
      </div>

      <div class="field">
        <label for="p1Phone">T√©l√©phone *</label>
        <input id="p1Phone" name="p1Phone" type="tel" required placeholder="Ex : +594... / 06...">
      </div>

      <div class="field">
        <label for="p1Email">Email</label>
        <input id="p1Email" name="p1Email" type="email" placeholder="optionnel">
      </div>

      <hr class="sep" />

      <h3 style="margin:0;">Joueur üë®</h3>

      <div class="field">
        <label for="p2LastName">Nom *</label>
        <input id="p2LastName" name="p2LastName" type="text" required placeholder="Nom">
      </div>

      <div class="field">
        <label for="p2FirstName">Pr√©nom *</label>
        <input id="p2FirstName" name="p2FirstName" type="text" required placeholder="Pr√©nom">
      </div>

      <div class="field">
        <label for="p2Licence">N¬∞ Licence *</label>
        <input id="p2Licence" name="p2Licence" type="text" required placeholder="Ex : 0123456A">
      </div>

      <div class="field">
        <label for="p2Phone">T√©l√©phone *</label>
        <input id="p2Phone" name="p2Phone" type="tel" required placeholder="Ex : +594... / 06...">
      </div>

      <div class="field">
        <label for="p2Email">Email</label>
        <input id="p2Email" name="p2Email" type="email" placeholder="optionnel">
      </div>

      <hr class="sep" />

      <button id="submitBtn" class="btn" type="submit" style="font-weight:800;">
        ‚úÖ Valider
      </button>

      <p id="status" class="muted" role="status" aria-live="polite"></p>

    </form>
  </section>

</main>

<!-- Firebase + Firestore (module) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // ‚úÖ Ta config
  const firebaseConfig = {
    apiKey: "AIzaSyDAW66BD1V2Kr2w6ksM1_8bHGugeG6_cUI",
    authDomain: "suzini-double-mixte-challenge.firebaseapp.com",
    projectId: "suzini-double-mixte-challenge",
    storageBucket: "suzini-double-mixte-challenge.firebasestorage.app",
    messagingSenderId: "148641893645",
    appId: "1:148641893645:web:d73cb1727a7b96af3ff444"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // üîß Collections (si tu veux d‚Äôautres noms, dis-moi)
  const COL_PRIVATE = "inscriptions_etape1";
  const COL_PUBLIC  = "inscriptions_etape1_public";

  const form = document.getElementById("signupForm");
  const statusEl = document.getElementById("status");
  const submitBtn = document.getElementById("submitBtn");

  const setStatus = (msg) => { statusEl.textContent = msg; };

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.classList.add("disabled");
    setStatus("Envoi en cours...");

    try {
      const data = {
        createdAt: serverTimestamp(),
        teamName: (form.teamName.value || "").trim(),

        p1FirstName: (form.p1FirstName.value || "").trim(),
        p1LastName:  (form.p1LastName.value || "").trim(),
        p1Licence:   (form.p1Licence.value || "").trim(),
        p1Phone:     (form.p1Phone.value || "").trim(),
        p1Email:     (form.p1Email.value || "").trim(),

        p2FirstName: (form.p2FirstName.value || "").trim(),
        p2LastName:  (form.p2LastName.value || "").trim(),
        p2Licence:   (form.p2Licence.value || "").trim(),
        p2Phone:     (form.p2Phone.value || "").trim(),
        p2Email:     (form.p2Email.value || "").trim(),
      };

      // Petite validation ‚Äúhumaine‚Äù
      if (!data.teamName || !data.p1FirstName || !data.p1LastName || !data.p2FirstName || !data.p2LastName) {
        throw new Error("Merci de compl√©ter tous les champs obligatoires.");
      }

      // 1) Priv√© : tout
      await addDoc(collection(db, COL_PRIVATE), data);

      // 2) Public : seulement √©quipe + pr√©noms + timestamp
      await addDoc(collection(db, COL_PUBLIC), {
        createdAt: serverTimestamp(),
        teamName: data.teamName,
        p1FirstName: data.p1FirstName,
        p2FirstName: data.p2FirstName
      });

      form.reset();
      setStatus("‚úÖ Inscription enregistr√©e !");
    } catch (err) {
      console.error(err);
      setStatus("‚ùå Erreur : " + (err?.message || "Impossible d‚Äôenregistrer l‚Äôinscription."));
    } finally {
      submitBtn.disabled = false;
      submitBtn.classList.remove("disabled");
    }
  });
</script>

</body>
</html>
