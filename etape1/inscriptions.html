<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscriptions â€” Ã‰tape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <h1 class="brand-title">Inscriptions â€” Ã‰tape 1</h1>

    <nav class="nav">
      <a href="index.html">â† Retour Ã‰tape 1</a>
    </nav>
  </div>
</header>

<main class="container">

  <section class="card">
    <h2>ğŸ“‹ Formulaire dâ€™inscription</h2>
    <p class="muted">Tous les champs sont obligatoires.</p>

    <form id="signupForm" class="form" autocomplete="on">

      <label class="field">
        <span>Nom de lâ€™Ã©quipe *</span>
        <input id="teamName" required autocomplete="organization" />
      </label>

      <hr class="sep">

      <h3>Joueur 1</h3>
      <label class="field"><span>Nom *</span><input id="p1LastName" required autocomplete="family-name" /></label>
      <label class="field"><span>PrÃ©nom *</span><input id="p1FirstName" required autocomplete="given-name" /></label>
      <label class="field"><span>NÂ° Licence *</span><input id="p1Licence" required inputmode="text" /></label>
      <label class="field"><span>TÃ©lÃ©phone *</span><input id="p1Phone" required inputmode="tel" autocomplete="tel" /></label>

      <hr class="sep">

      <h3>Joueur 2</h3>
      <label class="field"><span>Nom *</span><input id="p2LastName" required autocomplete="family-name" /></label>
      <label class="field"><span>PrÃ©nom *</span><input id="p2FirstName" required autocomplete="given-name" /></label>
      <label class="field"><span>NÂ° Licence *</span><input id="p2Licence" required inputmode="text" /></label>
      <label class="field"><span>TÃ©lÃ©phone *</span><input id="p2Phone" required inputmode="tel" autocomplete="tel" /></label>

      <button class="btn" type="submit">âœ… Valider</button>

      <p id="status" class="muted" aria-live="polite"></p>
    </form>
  </section>

</main>

<style>
  .form{display:grid;gap:10px;}
  .field{display:grid;gap:6px;}
  input{padding:12px;border:1px solid #ddd;border-radius:12px;}
  .sep{border:0;border-top:1px solid #eee;margin:8px 0;}
</style>

<script type="module">
  import { db } from "../shared/firebase.js";
  import { collection, addDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const $ = (id)=>document.getElementById(id);

  function cleanText(v){
    return (v ?? "").toString().trim();
  }

  function cleanPhone(v){
    // On garde + et chiffres, et espaces/tirets sont retirÃ©s
    return cleanText(v).replace(/[^0-9+]/g, "");
  }

  $("signupForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    $("status").textContent = "â³ Envoi en cours...";

    const payload = {
      teamName: cleanText($("teamName").value),

      p1LastName: cleanText($("p1LastName").value),
      p1FirstName: cleanText($("p1FirstName").value),
      p1Licence: cleanText($("p1Licence").value),
      p1Phone: cleanPhone($("p1Phone").value),

      p2LastName: cleanText($("p2LastName").value),
      p2FirstName: cleanText($("p2FirstName").value),
      p2Licence: cleanText($("p2Licence").value),
      p2Phone: cleanPhone($("p2Phone").value),

      createdAt: serverTimestamp()
    };

    // Petit contrÃ´le front (Ã©vite inscriptions vides)
    const requiredKeys = [
      "teamName","p1LastName","p1FirstName","p1Licence","p1Phone",
      "p2LastName","p2FirstName","p2Licence","p2Phone"
    ];
    const missing = requiredKeys.filter(k => !payload[k] || payload[k].length === 0);
    if (missing.length){
      $("status").textContent = "âŒ Merci de complÃ©ter tous les champs obligatoires.";
      return;
    }

    try{
      await addDoc(collection(db, "inscriptions_etape1"), payload);
      $("status").textContent = "âœ… Inscription envoyÃ©e !";
      e.target.reset();
    }catch(err){
      console.error(err);
      $("status").textContent = "âŒ Erreur, rÃ©essaie.";
    }
  });
</script>

</body>
</html>
