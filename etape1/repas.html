<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repas â€” Ã‰tape 1</title>
  <link rel="stylesheet" href="../assets/css/main.css" />
</head>
<body>

<header class="topbar">
  <div class="container">
    <div class="topbar-row topbar-row-step">
      <div class="brand-logo">
        <img src="../assets/img/logo-suzini.png" alt="Logo Suzini">
      </div>

      <div class="step-title-wrap">
        <img class="step-title-img" src="../assets/img/etape1.png" alt="Ã‰tape 1">
      </div>

      <div class="brand-logo">
        <img src="../assets/img/logo-challenge.png" alt="Logo Challenge">
      </div>
    </div>

    <!-- NAV Ã‰TAPE 1 -->
    <nav class="nav nav-step">
      <a href="../index.html">ğŸ </a>
      <a href="inscriptions.html">ğŸ“ Inscriptions</a>
      <a href="repas.html" aria-current="page">ğŸ½ï¸ Repas</a>
      <a href="programmation.html">ğŸ—“ï¸ Prog</a>
      <a href="equipes.html">ğŸ‘¥ Ã‰quipes</a>
      <a href="tirage.html">ğŸ² Tirage</a>
    </nav>
  </div>
</header>

<main class="container">

  <!-- Sous-onglets -->
  <section class="card">
    <h2 style="margin-bottom:6px;">ğŸ½ï¸ Espace repas</h2>

    <!-- âœ… version compacte sur 1 ligne -->
    <div class="subtabs subtabs-compact">
      <button class="subtab" id="tabFlyer" aria-selected="true">ğŸ“„ Flyer</button>
      <button class="subtab" id="tabCommander" aria-selected="false">ğŸ›’ Commander</button>
      <button class="subtab" id="tabCommandes" aria-selected="false">ğŸ“¦ Commandes</button>
    </div>
  </section>

  <!-- FLYER -->
  <section class="card" id="panelFlyer">
    <h2>ğŸ“„ Flyer officiel</h2>
    <div style="text-align:center;margin-top:15px;">
      <img src="../assets/img/flyer.jpeg"
           style="max-width:100%;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.08);">
    </div>
  </section>

  <!-- COMMANDER -->
  <section class="card" id="panelCommander" style="display:none;">
    <h2>ğŸ›’ Commander</h2>
    <!-- Contenu inchangÃ© -->
  </section>

  <!-- COMMANDES EFFECTUÃ‰ES -->
  <section class="card" id="panelCommandes" style="display:none;">
    <h2>ğŸ“¦ Commandes</h2>

    <p id="ordersStatus" class="muted">Chargementâ€¦</p>

    <div id="ordersList" class="orders-list"></div>
  </section>

</main>

<style>
/* ===== Bandeau ===== */
.topbar-row-step{
  grid-template-columns: var(--logo-size) 1fr var(--logo-size);
}
.step-title-wrap{
  display:flex;
  justify-content:center;
  align-items:center;
}
.step-title-img{
  max-height:80px;
  width:auto;
}
.nav-step{
  justify-content:space-between;
  gap:8px;
}
.nav-step a{
  flex:1 1 auto;
  text-align:center;
  padding:8px 6px;
}
.nav a[aria-current="page"]{
  background:rgba(255,255,255,.25);
}

/* ===== Sous-onglets compacts ===== */
.subtabs-compact{
  display:flex;
  gap:6px;
  flex-wrap:nowrap;
}
.subtabs-compact .subtab{
  flex:1 1 0;
  padding:8px 6px;
  font-size:13px;
  text-align:center;
}

/* ===== Liste commandes mobile ===== */
.orders-list{
  display:grid;
  gap:10px;
  margin-top:12px;
}
.order-card{
  border:1px solid #eee;
  border-radius:14px;
  padding:12px;
  background:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,.04);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.order-left{
  display:flex;
  flex-direction:column;
}
.order-name{
  font-weight:900;
}
.order-meta{
  font-size:14px;
  color:#555;
}
.order-right{
  text-align:right;
  font-weight:900;
}
</style>

<script type="module">
import { db } from "../assets/js/firebase.js";
import {
  collection,
  query,
  orderBy,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const COL_ORDERS = "repas_etape1";
const ordersList = document.getElementById("ordersList");
const ordersStatus = document.getElementById("ordersStatus");

function esc(s){
  return (s??"").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

const q = query(collection(db, COL_ORDERS), orderBy("beacheurName","asc"));

onSnapshot(q, (snap)=>{
  const rows=[];
  snap.forEach(d=>{
    const x=d.data()||{};
    rows.push({
      name:x.beacheurName||"",
      rank:x.rank||"â€”",
      qty:x.qty||0,
      total:x.total||0
    });
  });

  if(rows.length===0){
    ordersList.innerHTML=`<p class="muted">Aucune commande.</p>`;
    ordersStatus.textContent="ğŸŸ¢ 0 commande";
    return;
  }

  ordersList.innerHTML=rows.map(r=>`
    <div class="order-card">
      <div class="order-left">
        <div class="order-name">${esc(r.name)} (${esc(r.rank)})</div>
        <div class="order-meta">QtÃ© : ${esc(r.qty)}</div>
      </div>
      <div class="order-right">${esc(r.total)} â‚¬</div>
    </div>
  `).join("");

  ordersStatus.textContent=`ğŸŸ¢ ${rows.length} commande(s)`;
});
</script>

</body>
</html>
